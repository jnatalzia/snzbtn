<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Spark*</title>
<script src="http://js.leapmotion.com/0.2.0/leap.min.js"></script>
<script src="jquery.js"></script>
<!--//load classes-->
<script src="utilities/helper.js"></script>
<script src="utilities/Captions.js"></script>
<script src="classes/VariableBlock.js"></script>
<script src="classes/SpriteNode.js"></script>
<script src="classes/DragSpot.js"></script>
<script src="classes/Cutscene.js"></script>
<script src="classes/Hand.js"></script>

<script src="classes/LevelOne.js"></script>

<!--
<script src="classes/LevelSelect.js"></script> 
-->
<script src="classes/Audio.js"></script>
<script src="classes/Video.js"></script>
<script>
	var globalFrame;

	//Level Vars
	var currLevelNum = 1,currLevel;

	var canvas,ctx;

	var browserWidth,browserHeight;

	window.onload = function()
	{
		browserWidth = window.innerWidth;
		browserHeight = window.innerHeight;

		canvas = document.getElementById("canvas");
		ctx = canvas.getContext("2d");
		ctx.canvas.width  = window.innerWidth;
  		ctx.canvas.height = window.innerHeight;

  		//load all levels
  		currLevel = new LevelOne(); //for testing ------------------
  		//currLevel = new LevelSelect(); // for testing ------------------

  		currLevel.onloaded();

  		console.log(currLevel);

  		update();
	};
	window.onresize = function()
	{
		browserWidth = window.innerWidth;
		browserHeight = window.innerHeight;

		ctx.canvas.width  = window.innerWidth;
  		ctx.canvas.height = window.innerHeight;
	}
	// Setup Leap loop with frame callback function
	var controllerOptions = {enableGestures: true};
	
	Leap.loop(controllerOptions, function(f) {
		//console.log(f);
		globalFrame = f;
	});
	function update()
	{
		if (globalFrame)
		{

			ctx.clearRect(0,0,browserWidth,browserHeight);
			//commented to test varible block code
			//tempBlock.blockHoverTest(globalFrame,ctx);
			currLevel.update(ctx,globalFrame);
		}


		window.requestAnimationFrame(update);
		//console.log(globalFrame);
	}
	
	function isCloseToDestination(pos,dest)
	{
		//console.log(pos+ ", " + dest);

		var sub = getSubtractedVector(pos,dest);
		var mag = getMagnitude(sub);
		if (mag < 10)
		{
			return true;
		}
		else return false;
	}
	function getMagnitude(v1){
		return Math.sqrt((v1.x*v1.x)+(v1.y*v1.y));
	}
	function getNormalizedVector(v1){
		var mag = getMagnitude(v1);
		return{
			x:v1.x/mag,
			y:v1.y/mag
		};
	}
	//from v1->v2 which means v2-v1
	function getSubtractedVector(v1,v2){
		return {
			x: v2.x-v1.x,
			y: v2.y-v1.y
		};
	}
	function angleFromPointToPoint(p1,p2)
	{
		var sub = getSubtractedVector(p1,p2);

		var angle = Math.atan2(sub.y,sub.x);

		if (angle < 0){
			angle = Math.abs(angle);
			angle = Math.PI*2 - angle;
			
		}
		//angle = Math.abs(angle - Math.PI);


		return angle;
	}
	function getScaledVector(v1,scalar){
		return {
			x:v1.x*scalar,
			y:v1.y*scalar
		};
	}

	
	function setCirclePos($circ,point)
	{
		var pos = point.tipPosition;
			
		var x = pos[0];
		var y = pos[1];
		var z = pos[2];
			
			
			
		x = map(x,-150,150,0,browserWidth);
		y = map(y,100,300,0,browserHeight);
			
		//because of the inversion when dealing with screen
		y = browserHeight - y;
			
		$circ.css({
				left:x,
				top:y
			});
	}
	function setCircleWidth($circ,point)
	{
		//fix me
	
		var pos = point.tipPosition;
		var z = pos[2],oldz=z;
		
		z = map(z,-50,100,20,100);
		
		var op = map(z,20,80,.2,.8);
		
		op = 1-op;
		
		if (z <= 20) 
		{
			$circ.addClass('clicked'); 
			//console.log($circ.offset())
		}
		else $circ.removeClass('clicked');
		
		$circ.css({
				width:z,
				height:z,
				"border-radius":z,
				opacity:op
			});
	}
	function vectorToString(vector, digits) {
	  if (typeof digits === "undefined") {
		digits = 1;
	  }
	  return "(" + vector[0].toFixed(digits) + ", "
				 + vector[1].toFixed(digits) + ", "
				 + vector[2].toFixed(digits) + ")";
	}
	function map(value, start1, stop1, start2, stop2) {
		if (value < start1) value = start1;
		else if (value > stop1) value = stop1;
	
		return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
	}
	function circlesIntersect(c1,c2){
		var dx = c2.x - c1.x;
		var dy = c2.y - c1.y;
		var distance = Math.sqrt(dx*dx + dy*dy);
		return distance < c1.radius + c2.radius;
	}
	function pointIntersectsRect(pt,rect)
	{
		return (pt.x > rect.x && pt.x < rect.x + rect.width && pt.y > rect.y && pt.y < rect.y + rect.height);
	}
</script>
<style>
	@font-face {
	    font-family: 'GothamMedium';
	    src: url('fonts/Gotham-Medium.otf');
	}

	/* http://meyerweb.com/eric/tools/css/reset/ 
	   v2.0 | 20110126
	   License: none (public domain)
	*/

	html, body, div, span, applet, object, iframe,
	h1, h2, h3, h4, h5, h6, p, blockquote, pre,
	a, abbr, acronym, address, big, cite, code,
	del, dfn, em, img, ins, kbd, q, s, samp,
	small, strike, strong, sub, sup, tt, var,
	b, u, i, center,
	dl, dt, dd, ol, ul, li,
	fieldset, form, label, legend,
	table, caption, tbody, tfoot, thead, tr, th, td,
	article, aside, canvas, details, embed, 
	figure, figcaption, footer, header, hgroup, 
	menu, nav, output, ruby, section, summary,
	time, mark, audio, video {
		margin: 0;
		padding: 0;
		border: 0;
		font-size: 100%;
		font: inherit;
		vertical-align: baseline;
	}
	/* HTML5 display-role reset for older browsers */
	article, aside, details, figcaption, figure, 
	footer, header, hgroup, menu, nav, section {
		display: block;
	}
	body {
		line-height: 1;
	}
	ol, ul {
		list-style: none;
	}
	blockquote, q {
		quotes: none;
	}
	blockquote:before, blockquote:after,
	q:before, q:after {
		content: '';
		content: none;
	}
	table {
		border-collapse: collapse;
		border-spacing: 0;
	}
	.circ
	{
		opacity:.4;
		width:20px;
		height:20px;
		border-radius:20px;
		position:absolute;
		background-color:#555;
		margin-top:-10px;
		margin-left:-10px;
		border:3px solid #111;
	}
	.circ.clicked
	{
		background-color:#A8A0EB;
		border:3px solid #A8A0EB;d
	}
</style>
</head>
<body>
	<canvas id='canvas'>GET A BROWSER</canvas>
</body>
</html>